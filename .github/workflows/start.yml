name: start subfoldersync-vibe

on:
  workflow_call:
    inputs:
        source_repo:
            description: 'The repository to sync from, e.g., IMOitself/A'
            required: true
            type: string
        destination_repo:
            description: 'The repository to sync to, e.g., IMOitself/B'
            required: true
            type: string
        subfolder_path:
            description: 'The path to the subfolder to sync'
            required: true
            type: string
        username:
            description: 'The GitHub username to use for commits'
            required: true
            type: string
    secrets:
        gh_pat:
            description: 'A GitHub PAT with repo write access'
            required: true

jobs:
    sync:
        runs-on: ubuntu-latest
        steps:
            

            - name: Clone subfoldersync-vibe repo
              uses: actions/checkout@v4
              with:
                repository: 'IMOitself/subfoldersync-vibe'
                path: subfoldersync-vibe

            - name: Checkout Destination Repo
              uses: actions/checkout@v4
              with:
                repository: ${{ inputs.destination_repo }}
                path: dest_repo

            - name: Run sync script
              working-directory: dest_repo
              env:
                SOURCE_REPO: ${{ inputs.source_repo }}
                SUBFOLDER_PATH: ${{ inputs.subfolder_path }}
              run: |
                chmod +x ../subfoldersync-vibe/sync-subfolders.sh
                ../subfoldersync-vibe/sync-subfolders.sh

            - name: Commit changes
              uses: stefanzweifel/git-auto-commit-action@v6
              with:
                repository: dest_repo
                commit_message: "chore: sync subfolder from ${{ inputs.source_repo }}"